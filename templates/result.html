<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body onload="save()">
<div class="app-shell">
    <div class="header"><a href="/" class="back-arrow">â†</a><h1>Results</h1></div>
    <div class="card" style="text-align:center;">
        <h1 style="color:var(--blue); font-size:45px; margin:0;">{{ potholes }}</h1>
        <p>Potholes Found</p>
        <p style="font-size:11px; margin-bottom:10px;">ğŸ“ {{ address }}</p>
        <iframe width="100%" height="180" style="border-radius:15px; border:none;" 
            src="https://maps.google.com/maps?q={{lat}},{{lon}}&z=15&output=embed">
        </iframe>
    </div>
    <div class="card">
        <div class="image-grid">
            {% for img in images %} <img src="/static/results/{{img}}"> {% endfor %}
        </div>
        <button class="btn btn-blue" onclick="go()">ğŸ“¢ Generate Report</button>
        <button class="btn btn-outline" onclick="window.location.href='/'">ğŸ  Go Home</button>
    </div>
</div>
<script>
const reportDate = new Date().toLocaleString();
function save() {
    let h = JSON.parse(localStorage.getItem('pothole_history') || '[]');
    const fullImgs = {{ images|tojson }}.map(img => window.location.origin + '/static/results/' + img);
    h.unshift({ potholes: "{{potholes}}", address: "{{address}}", lat:"{{lat}}", lon:"{{lon}}", images: fullImgs, date: reportDate });
    localStorage.setItem('pothole_history', JSON.stringify(h));
}
function go() {
    sessionStorage.setItem('current_complaint', JSON.stringify({ 
        potholes: "{{potholes}}", address: "{{address}}", lat: "{{lat}}", lon: "{{lon}}", all_images: {{ images|tojson }}, date: reportDate 
    }));
    window.location.href = '/complaint';
}
</script>
</body>
</html>